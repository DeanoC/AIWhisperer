# Debbie Batch Mode Usage Example

## Overview
This example demonstrates how to use Debbie's batch processing capabilities to automate tasks.

## Example 1: JSON Format Script

Create a file `setup_project.json`:

```json
{
  "name": "Setup New Python Project",
  "description": "Initialize a new Python project with standard structure",
  "steps": [
    {
      "action": "create_file",
      "path": "README.md",
      "content": "# My New Project\n\nA Python project created by Debbie."
    },
    {
      "action": "create_file", 
      "path": "requirements.txt",
      "content": "pytest>=7.0.0\nblack>=22.0.0\nmypy>=0.950"
    },
    {
      "action": "create_file",
      "path": "src/__init__.py",
      "content": ""
    },
    {
      "action": "create_file",
      "path": "src/main.py",
      "content": "def main():\n    print('Hello from Debbie!')\n\nif __name__ == '__main__':\n    main()"
    },
    {
      "action": "create_file",
      "path": "tests/__init__.py",
      "content": ""
    },
    {
      "action": "create_file",
      "path": "tests/test_main.py",
      "content": "from src.main import main\n\ndef test_main(capsys):\n    main()\n    captured = capsys.readouterr()\n    assert 'Hello from Debbie!' in captured.out"
    },
    {
      "action": "execute_command",
      "command": "python -m venv .venv"
    },
    {
      "action": "list_files",
      "path": "."
    }
  ]
}
```

## Example 2: Text Format Script

Create a file `daily_tasks.txt`:

```
# Daily development tasks
# Run this script to set up your daily work environment

# Check current directory
list files in .

# Create today's work log
create file work_log_2025_05_30.md with content "# Work Log - May 30, 2025\n\n## Tasks\n- [ ] Review PRs\n- [ ] Update documentation\n- [ ] Run tests\n\n## Notes\n"

# Check git status
execute command 'git status'

# List recent RFCs
list all rfcs

# Switch to Patricia for RFC work
switch to agent patricia

# Create a new RFC if needed
create rfc 'Batch Processing Enhancement' with 'Improve batch script error handling and reporting'
```

## Example 3: YAML Format with Context

Create a file `analyze_codebase.yaml`:

```yaml
name: Codebase Analysis
description: Analyze project structure and create report
steps:
  - action: list_files
    path: src

  - action: analyze_languages
    path: .

  - action: get_project_structure
    path: .
    max_depth: 3

  - action: create_file
    path: analysis_report.md
    content: |
      # Codebase Analysis Report
      
      Generated by Debbie the Batcher
      
      ## Project Structure
      See attached project structure analysis.
      
      ## Language Distribution
      See language analysis results.
      
      ## Recommendations
      - Consider adding more tests
      - Update documentation
      - Review code organization

  - action: workspace_stats
    path: .
```

## Using Debbie for Batch Processing

### From AIWhisperer CLI:

```bash
# First, parse and validate the script
python -m ai_whisperer.main agent d execute script_parser parse /path/to/script.json

# Then execute it
python -m ai_whisperer.main agent d execute batch_command script /path/to/script.json

# Or with options
python -m ai_whisperer.main agent d execute batch_command script /path/to/script.json --stop-on-error --dry-run
```

### From Interactive Mode:

1. Start the interactive server
2. Select Debbie as your agent
3. Ask her to run a batch script:
   - "Parse and execute the setup script at /scripts/setup_project.json"
   - "Run the daily tasks script with dry run mode"
   - "Execute my analysis script and stop if any errors occur"

### Natural Language Commands Supported:

Debbie understands these command patterns:
- `list files in /path`
- `show directory /path`
- `read file /path/to/file`
- `create file /path/to/file with content "content"`
- `update file /path/to/file with "new content"`
- `execute command 'shell command'`
- `run command 'shell command'`
- `switch to agent patricia`
- `search for "pattern" in /path`
- `list all rfcs`
- `create rfc "Title" with "Description"`

## Best Practices

1. **Use JSON for complex scripts** with many parameters
2. **Use text format for simple sequential commands**
3. **Use YAML for scripts with multi-line content**
4. **Always validate scripts before execution** (automatic)
5. **Use dry-run mode to preview actions**
6. **Enable stop-on-error for critical scripts**
7. **Use context passing for dependent steps**

## Security Notes

Debbie enforces these security rules:
- No path traversal (../ patterns)
- No access to system directories (/etc, /usr, etc.)
- File size limits (1MB max)
- Maximum 1000 steps per script
- Only allowed actions can be executed

## Error Handling

Debbie provides detailed error information:
- Which step failed
- Why it failed
- Whether execution continued or stopped
- Summary of successful vs failed steps

Example error output:
```
{
  "success": false,
  "completed_steps": 3,
  "failed_steps": 1,
  "total_steps": 5,
  "results": [
    {"success": true, "action": "create_file", ...},
    {"success": true, "action": "list_files", ...},
    {"success": false, "error": "Permission denied", "action": "write_file", ...},
    {"success": true, "action": "read_file", ...}
  ]
}
```