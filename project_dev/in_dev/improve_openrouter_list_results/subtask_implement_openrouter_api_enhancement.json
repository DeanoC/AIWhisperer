{
  "description": "Modify OpenRouterAPI.list_models to fetch detailed model information.",
  "depends_on": [],
  "agent_spec": {
    "type": "file_edit",
    "input_artifacts": [
      "src/ai_whisperer/openrouter_api.py",
      "docs/openrouter_model_enhancement_plan.md",
      "tests/unit/test_openrouter_model_listing.py"
    ],
    "output_artifacts": [
      "src/ai_whisperer/openrouter_api.py"
    ],
    "instructions": [
      "Locate the `list_models` method within the `OpenRouterAPI` class in `src/ai_whisperer/openrouter_api.py`.",
      "Replace the current implementation with code that makes a GET request to the OpenRouter API endpoint specifically designed for listing models with detailed information. Refer to `docs/openrouter_model_enhancement_plan.md` for the correct endpoint URL and any required parameters.",
      "Parse the JSON response received from the API call.",
      "Extract the following detailed information for each model from the parsed response: features, cost (input and output tokens), context window size, and provider.",
      "Structure the extracted data into a list of dictionaries or a list of custom objects, ensuring each item in the list represents a single model and contains the extracted detailed fields.",
      "Modify the `list_models` method to return this structured data object.",
      "Ensure that the changes made to `list_models` do not negatively impact other methods within the `OpenRouterAPI` class that interact with the OpenRouter API.",
      "Review `tests/unit/test_openrouter_model_listing.py` and update or add new tests as necessary to cover the new functionality and ensure the detailed model information is correctly retrieved and structured."
    ],
    "constraints": [
      "The modification must be confined to the `list_models` method.",
      "The code must handle potential API errors gracefully (e.g., network issues, invalid response).",
      "The return format must be easily consumable by other parts of the AIWhisperer tool."
    ],
    "validation_criteria": [
      "The file `src/ai_whisperer/openrouter_api.py` has been modified.",
      "The `list_models` method in `OpenRouterAPI` now makes an API call to fetch detailed model information.",
      "The method successfully parses the API response.",
      "The method returns a structured data object (list of dicts/objects) containing detailed fields like features, cost, context window, and provider for each model.",
      "Existing unit tests for other `OpenRouterAPI` methods pass.",
      "New or updated unit tests for `list_models` pass, verifying the retrieval and structure of detailed model information.",
      "The modified code passes basic Python syntax checks."
    ]
  },
  "step_id": "implement_openrouter_api_enhancement",
  "task_id": "1b82deca-8c11-4330-aa30-01a2ff98799f"
}