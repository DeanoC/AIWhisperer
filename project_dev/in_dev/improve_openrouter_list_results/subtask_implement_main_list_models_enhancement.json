{
  "description": "Modify main.py to accept the --output-csv argument and call the enhanced OpenRouter API method.",
  "depends_on": [],
  "agent_spec": {
    "type": "file_edit",
    "input_artifacts": [
      "src/ai_whisperer/main.py",
      "docs/internal_process/openrouter_list_enhancement_plan.md",
      "tests/unit/test_main_list_models.py"
    ],
    "output_artifacts": [
      "src/ai_whisperer/main.py"
    ],
    "instructions": [
      "Edit the file `src/ai_whisperer/main.py`.",
      "Locate the argument parsing section for the `--list-models` command.",
      "Add a new optional argument `--output-csv` to this parser. This argument should expect a file path.",
      "Find the code block that handles the `--list-models` command execution.",
      "Modify this block to call the enhanced `list_models` method from the `openrouter_api` module. This method is expected to return more detailed information.",
      "Implement logic to check if the `--output-csv` argument was provided.",
      "If `--output-csv` is present, write the detailed output received from the enhanced `list_models` method to the specified file path in CSV format.",
      "If `--output-csv` is NOT present, process the output from the enhanced `list_models` method and format it for console output, maintaining the existing look and feel as much as possible.",
      "Ensure that the existing console output behavior when `--output-models` is used without `--output-csv` remains functional and displays the necessary information.",
      "Consult `docs/internal_process/openrouter_list_enhancement_plan.md` for details on the expected output format and behavior.",
      "Refer to `tests/unit/test_main_list_models.py` to understand the expected interactions and outputs."
    ],
    "constraints": [
      "Only modify the `src/ai_whisperer/main.py` file.",
      "Do not break the existing `--list-models` console output functionality when the `--output-csv` argument is omitted.",
      "Ensure the CSV output format is correct and includes the detailed model information."
    ],
    "validation_criteria": [
      "The file `src/ai_whisperer/main.py` has been successfully modified.",
      "The argument parser in `src/ai_whisperer/main.py` correctly recognizes and parses the `--output-csv` argument when used with `--list-models`.",
      "The code logic correctly branches based on the presence or absence of the `--output-csv` argument.",
      "When `--output-csv` is provided, the enhanced `list_models` method from `openrouter_api` is called.",
      "When `--output-csv` is provided, the detailed output is written to the specified file in CSV format.",
      "When `--output-csv` is absent, the enhanced `list_models` method is called, and the output is formatted and printed to the console, preserving the original console output behavior."
    ]
  },
  "step_id": "implement_main_list_models_enhancement",
  "task_id": "3628f8eb-55d4-4e1e-84fe-6f0f97d383dd"
}