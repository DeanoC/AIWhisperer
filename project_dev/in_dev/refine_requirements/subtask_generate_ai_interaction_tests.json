{
  "description": "Generate tests for interacting with the AI for requirements refinement.",
  "depends_on": [],
  "agent_spec": {
    "type": "test_generation",
    "input_artifacts": [
      "project_dev/in_dev/refine_requirements/plan_summary.md",
      "src/ai_whisperer/openrouter_api.py"
    ],
    "output_artifacts": [
      "tests/unit/test_refine_ai_interaction.py"
    ],
    "instructions": [
      "Create a new Python file `tests/unit/test_refine_ai_interaction.py`.",
      "Write unit tests within this file to cover the AI interaction logic for the requirements refinement feature.",
      "Specifically, include tests for:",
      "- Verifying the correct construction of the prompt sent to the AI, ensuring it includes the default prompt structure and the content of the requirement document.",
      "- Testing the functionality to incorporate a custom prompt provided by the user, overriding or augmenting the default prompt structure.",
      "- Simulating the handling of a mocked AI response, ensuring the application processes the response correctly.",
      "- Mocking file writing operations to test that the processed AI response is saved to the designated new requirement file.",
      "Use mocking techniques (e.g., `unittest.mock`) to prevent actual calls to external AI APIs like OpenRouter.",
      "Ensure tests are well-structured and cover edge cases related to prompt content and AI responses."
    ],
    "constraints": [
      "Tests must use mocking and not make actual external API calls.",
      "The tests should focus solely on the AI interaction logic, not the overall application flow or other features.",
      "The output file must be `tests/unit/test_refine_ai_interaction.py`."
    ],
    "validation_criteria": [
      "The file `tests/unit/test_refine_ai_interaction.py` has been created.",
      "The file `test_refine_ai_interaction.py` contains test functions that specifically verify the logic for constructing the AI prompt.",
      "The file `test_refine_ai_interaction.py` includes test functions that simulate and validate the handling of mocked AI responses.",
      "The file `test_refine_ai_interaction.py` contains test functions that confirm the correct usage and incorporation of custom prompts."
    ]
  },
  "step_id": "generate_ai_interaction_tests",
  "task_id": "45512229-1ac2-4ee7-a859-5c5ff96118d1",
  "subtask_id": "7df61ba1-643c-4503-b1c9-fae106a2e402"
}