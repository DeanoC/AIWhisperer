# RFC: Debbie the Debugging Helper Enhancement

**RFC ID**: RFC-2025-05-29-0003  
**Title**: Transform Debbie into an Intelligent Debugging Assistant  
**Author**: Deano  
**Status**: archived
**Created**: 2025-05-29  
**Updated**: 2025-05-29  

## Summary

Transform Debbie the Batcher from a simple batch script executor into an intelligent debugging companion that can autonomously investigate issues, monitor AI agent behavior, provide actionable insights during AIWhisperer development, and execute Python scripts for advanced debugging analysis.

## Motivation

Current debugging challenges in AIWhisperer include:
- Agents stalling and waiting for user input (continuation issue)
- Difficult to reproduce edge cases and timing issues
- Limited visibility into agent decision-making
- Manual intervention required for common debugging tasks
- Workspace detection failures blocking development

Debbie can be enhanced to address these challenges by becoming an active debugging participant rather than a passive script executor.

## Goals

1. **Automated Issue Detection**: Debbie monitors sessions and detects common problems
2. **Proactive Intervention**: Debbie can unstick agents and recover from errors
3. **Enhanced Observability**: Deep insights into system behavior and performance
4. **Reproducible Debugging**: Record and replay problematic scenarios
5. **Developer Productivity**: Reduce manual debugging effort

## Non-Goals

- Replacing manual debugging entirely
- Modifying core AIWhisperer architecture
- Creating a general-purpose testing framework
- Building a production monitoring system

## Detailed Design

### 1. Core Architecture

Debbie operates as a specialized agent with debugging-focused tools and capabilities:

```yaml
d:
  name: "Debbie the Debugger"
  role: "debugging_assistant"
  description: "Intelligent debugging companion for AIWhisperer development"
  tool_tags: ["debugging", "monitoring", "testing", "analysis"]
  prompt_file: "debbie_debugger.prompt.md"
  context_sources: ["session_history", "error_logs", "performance_metrics"]
  color: "#FF5722"
  icon: "ðŸ›"
  tool_sets: ["debugging_tools", "filesystem", "command", "analysis"]
```

### 2. Debugging Tools

New tools specifically for debugging:

#### SessionInspectorTool
- Analyzes active session state and message history
- Detects patterns like stalled agents or tool loops
- Provides session health metrics

#### MessageInjectorTool
- Injects messages to unstick agents
- Simulates user responses for testing
- Supports timed and conditional injection

#### WorkspaceValidatorTool
- Verifies .WHISPER folder existence
- Checks configuration files
- Validates API keys and dependencies

#### MetricCollectorTool
- Tracks response times and token usage
- Monitors memory consumption
- Generates performance reports

#### ScenarioRecorderTool
- Records interaction sequences
- Enables replay for regression testing
- Supports parameterized scenarios

#### PythonExecutorTool
- Executes Python scripts for advanced debugging
- Provides debugging context (logs, state, session)
- Includes data analysis libraries (pandas, matplotlib)
- Sandboxed execution with resource limits

#### LogAnalyzerTool
- Comprehensive log analysis across sources
- Pattern detection and anomaly identification
- Performance bottleneck detection
- Generates actionable recommendations

### 3. Debbie's Capabilities

#### Monitoring Mode
```python
class DebbieMonitor:
    def __init__(self, session_manager):
        self.session_manager = session_manager
        self.anomaly_detector = AnomalyDetector()
        self.metrics = MetricsCollector()
    
    async def monitor_session(self, session_id):
        """Monitor a session for debugging events"""
        while self.is_monitoring:
            state = await self.session_manager.get_state(session_id)
            
            # Check for continuation stalls
            if self.detect_stall(state):
                await self.inject_continuation(session_id)
            
            # Collect metrics
            self.metrics.record(state)
            
            # Detect anomalies
            anomalies = self.anomaly_detector.analyze(state)
            if anomalies:
                await self.handle_anomalies(anomalies)
```

#### Intervention Strategies
1. **Smart Prompting**: Inject contextual prompts when agents stall
2. **State Reset**: Clear problematic state while preserving context
3. **Tool Retry**: Re-execute failed tool calls with modifications
4. **Session Restart**: Gracefully restart session with saved context

### 4. Script Language Extensions

Enhanced Debbie script syntax for debugging:

```
# Monitor and intervene
monitor session_id=current
on stall after=30s {
    inject "Please continue with the task"
    if still_stalled after=10s {
        dump_state to="debug_dump.json"
        restart_session with_context=true
    }
}

# Performance testing
benchmark "code_generation" {
    measure response_time, token_usage, memory
    compare_with baseline="benchmarks/baseline.json"
    alert_if response_time > 10s
}

# Workspace validation
validate {
    check workspace=".WHISPER"
    check config="config.yaml"
    check api_key="OPENROUTER_API_KEY"
    report_issues to="health_report.md"
}
```

### 5. Enhanced Logging System

Debbie requires sophisticated multi-source logging to effectively debug sessions:

#### Multi-Source Log Management
- **LogSource enum**: Identifies log origin (Debbie, Server, Agent, Tool, etc.)
- **EnhancedLogMessage**: Extended dataclass with debugging context
- **Correlation IDs**: Links related events across components
- **Performance metrics**: Embedded timing and resource usage

#### Debbie's Commentary System
- **Intelligent insights**: Debbie adds explanatory comments to logs
- **Pattern detection**: Identifies common issues and suggests solutions
- **Confidence scoring**: Rates the likelihood of identified issues
- **Actionable recommendations**: Provides specific debugging steps

#### Log Aggregation & Analysis
- **Timeline building**: Reconstructs event sequences
- **Real-time streaming**: Live log monitoring with filters
- **Alert system**: Triggers on specific conditions
- **Export capabilities**: Various formats for external analysis

### 6. Python Script Execution

Debbie can write and execute Python scripts for advanced debugging:

```python
# Example: Analyze session performance
tool_times = defaultdict(list)
for log in logs:
    if log.source == LogSource.TOOL and log.duration_ms:
        tool_times[log.details['tool_name']].append(log.duration_ms)

# Create performance report
df = pd.DataFrame([...])
print("Tool Performance Report:")
print(df.sort_values('avg_time_ms', ascending=False))
```

#### Script Library
Pre-written scripts for common debugging tasks:
- Performance analysis
- Error pattern detection
- Memory usage tracking
- Token usage reporting
- Agent behavior analysis
- WebSocket message flow visualization

### 7. Integration Points

#### WebSocket Enhancement
- Message interception layer for monitoring
- Event hooks for debugging actions
- Performance instrumentation

#### Session Manager Integration
- Debug mode flag for enhanced logging
- State snapshot capability
- Intervention API

#### Agent System Integration
- Debug context injection
- Tool usage tracking
- Decision logging

#### Logging Infrastructure
- Extended LogMessage with source tracking
- Real-time log streaming
- Debbie's commentary integration
- Performance metric collection

## Implementation Plan

### Phase 1: Foundation (Week 1)
- Complete basic Debbie implementation
- Fix workspace detection issues
- Add Debbie to agent registry
- Create debugging tool base classes

### Phase 2: Core Tools (Week 2)
- Implement SessionInspectorTool
- Implement MessageInjectorTool
- Implement WorkspaceValidatorTool
- Create Debbie's system prompt

### Phase 3: Monitoring (Week 3)
- Build monitoring infrastructure
- Implement stall detection
- Add metric collection
- Create intervention system

### Phase 4: Advanced Features (Week 4)
- Scenario recording/replay
- Performance benchmarking
- Anomaly detection
- Debug report generation

## Testing Strategy

1. **Unit Tests**: Each debugging tool thoroughly tested
2. **Integration Tests**: Debbie's interaction with system components
3. **Scenario Tests**: Common debugging scenarios automated
4. **Performance Tests**: Ensure Debbie doesn't impact system performance

## Security Considerations

- Debbie operates with elevated permissions for debugging
- Message injection is restricted to development environments
- State dumps sanitize sensitive information
- Access controls for debugging commands

## Alternatives Considered

1. **External Debugging Tool**: Separate application for debugging
   - Rejected: Loses context and agent intelligence
   
2. **Built-in Debugging Mode**: Add debugging to existing agents
   - Rejected: Violates single responsibility principle
   
3. **Log Analysis Only**: Passive log monitoring
   - Rejected: Misses opportunity for active intervention

## Future Extensions

1. **ML-Powered Predictions**: Predict failures before they occur
2. **Distributed Debugging**: Debug across multiple instances
3. **Visual Debugging**: Web UI for debugging sessions
4. **Plugin System**: Custom debugging tools for specific needs

## Migration Strategy

1. Keep existing batch mode functional during development
2. Gradually add debugging features
3. Provide compatibility layer for existing scripts
4. Document new capabilities with examples

## Success Metrics

- 50% reduction in average debugging time
- 90% of common issues automatically detected
- 75% of stalled agents automatically recovered
- Developer satisfaction score > 4/5

## Conclusion

Enhancing Debbie into an intelligent debugging assistant will significantly improve the AIWhisperer development experience. By providing automated detection, proactive intervention, and deep insights, Debbie becomes an invaluable tool for maintaining and improving the system.

## Refinement History
- 2025-05-31 05:09:19: Status changed from 'new' to 'archived' - User requested archival of existing RFCs
